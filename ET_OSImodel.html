<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSI Layer Card Sort Activity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the interactive elements */
        .layer-zone {
            min-height: 120px; /* Smaller height for 7 layers */
            border: 2px dashed #4b5563; /* Gray-600 */
            transition: all 0.2s;
            /* Ensures layers stack top to bottom clearly */
            margin-bottom: 0.5rem; 
        }
        .layer-zone.drag-over {
            border-color: #f97316; /* Orange-500 */
            background-color: #fff7ed; /* Orange-50 */
        }
        .draggable-item {
            cursor: grab;
            user-select: none;
            transition: transform 0.1s;
        }
        .draggable-item:active {
            cursor: grabbing;
        }
        /* Styling for print view (submission proof) */
        @media print {
            body { background-color: white; }
            .no-print { display: none; }
            .draggable-item { 
                border: 1px solid #e5e7eb !important; 
                box-shadow: none !important;
                margin-bottom: 0.25rem; /* Better spacing for print */
            }
            .layer-zone { 
                border: 2px solid #1f2937 !important; 
                padding: 0.75rem !important;
            }
        }
        /* Custom colors for layers 1-7 (Optional but helps visualize the stack) */
        .layer-7 { background-color: #ecfdf5; border-color: #059669; } /* Green */
        .layer-6 { background-color: #e0f2fe; border-color: #0ea5e9; } /* Light Blue */
        .layer-5 { background-color: #f0f9ff; border-color: #3b82f6; } /* Blue */
        .layer-4 { background-color: #fefce8; border-color: #eab308; } /* Yellow */
        .layer-3 { background-color: #fae8ff; border-color: #a855f7; } /* Purple */
        .layer-2 { background-color: #fee2e2; border-color: #ef4444; } /* Red */
        .layer-1 { background-color: #f3f4f6; border-color: #6b7280; } /* Gray */

    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 lg:p-10">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">
            üåê OSI Layer Card Sort Activity
        </h1>
        <p class="text-gray-600 mb-6">
            Drag each networking example into the correct OSI layer. Use the <strong class="text-red-600">Teacher Circulates Asking</strong> prompts to discuss your choices.
        </p>

        <div id="status-message" class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded-lg" role="alert">
            <p class="font-bold">Instructions:</p>
            <p>Drag all items into their correct layers. When complete, click 'Check Stack' to verify your answers.</p>
        </div>

        <div class="space-y-2" id="diagram-container">

            <div id="layer7-zone" data-layer="Layer 7: Application" class="layer-zone layer-7 rounded-lg p-3">
                <h2 class="font-bold text-lg text-green-700">7. Application (User Interface)</h2>
                <textarea id="layer7-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 7..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer7-items"></div>
            </div>

            <div id="layer6-zone" data-layer="Layer 6: Presentation" class="layer-zone layer-6 rounded-lg p-3">
                <h2 class="font-bold text-lg text-blue-600">6. Presentation (Data Format/Encryption)</h2>
                <textarea id="layer6-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 6..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer6-items"></div>
            </div>

            <div id="layer5-zone" data-layer="Layer 5: Session" class="layer-zone layer-5 rounded-lg p-3">
                <h2 class="font-bold text-lg text-blue-700">5. Session (Connection Management)</h2>
                <textarea id="layer5-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 5..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer5-items"></div>
            </div>

            <div id="layer4-zone" data-layer="Layer 4: Transport" class="layer-zone layer-4 rounded-lg p-3">
                <h2 class="font-bold text-lg text-yellow-700">4. Transport (End-to-End Reliability/Flow)</h2>
                <textarea id="layer4-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 4..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer4-items"></div>
            </div>

            <div id="layer3-zone" data-layer="Layer 3: Network" class="layer-zone layer-3 rounded-lg p-3">
                <h2 class="font-bold text-lg text-purple-700">3. Network (Routing/Logical Addressing)</h2>
                <textarea id="layer3-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 3..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer3-items"></div>
            </div>
            
            <div id="layer2-zone" data-layer="Layer 2: Data Link" class="layer-zone layer-2 rounded-lg p-3">
                <h2 class="font-bold text-lg text-red-700">2. Data Link (Framing/Physical Addressing)</h2>
                <textarea id="layer2-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 2..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer2-items"></div>
            </div>

            <div id="layer1-zone" data-layer="Layer 1: Physical" class="layer-zone layer-1 rounded-lg p-3">
                <h2 class="font-bold text-lg text-gray-700">1. Physical (Media/Signal)</h2>
                <textarea id="layer1-explanation" class="w-full text-sm text-gray-700 p-2 border rounded-md my-1" rows="1" placeholder="Add your one-sentence explanation for Layer 1..."></textarea>
                <div class="flex flex-wrap gap-2 min-h-[40px]" id="layer1-items"></div>
            </div>
            
        </div>

        <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-4 border-t pt-4 no-print">Items to Classify</h2>
        <div id="item-bin" class="flex flex-wrap gap-3 p-4 bg-gray-200 rounded-lg min-h-[100px] no-print">
            </div>

        <div class="mt-6 space-y-3 no-print">
            <button id="check-button" onclick="checkStack()" class="w-full py-3 px-4 bg-orange-600 text-white font-semibold rounded-lg shadow-md hover:bg-orange-700 transition duration-150">
                Check Stack
            </button>
            <button id="print-button" onclick="printDiagram()" class="w-full py-3 px-4 bg-gray-400 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-500 transition duration-150 hidden">
                Print/Save as PDF (For Submission)
            </button>
        </div>
        

    </div>

    <script>
        // Global variables for platform standards (ignored for this activity)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- Activity Data ---
        // layer: Must match the format 'Layer X'
        const ITEMS = [
            // Layer 1
            { id: 'ethernet', name: 'Ethernet cable', icon: 'üîó', layer: 'Layer 1' },
            { id: 'wifi-signal', name: 'Wi-Fi signal', icon: 'üì°', layer: 'Layer 1' },
            
            // Layer 2
            { id: 'mac-address', name: 'MAC address', icon: 'üìç', layer: 'Layer 2' },
            
            // Layer 3
            { id: 'ip-address', name: 'IP address', icon: 'üåê', layer: 'Layer 3' },
            { id: 'router-path', name: 'Router choosing best path', icon: 'üõ£Ô∏è', layer: 'Layer 3' },

            // Layer 4
            { id: 'tcp-delivery', name: 'TCP ensuring packets are delivered', icon: 'üì¶', layer: 'Layer 4' },
            { id: 'udp-gaming', name: 'UDP used in gaming', icon: 'üéÆ', layer: 'Layer 4' },

            // Layer 5
            { id: 'zoom-call', name: 'Zoom call staying connected', icon: 'üìû', layer: 'Layer 5' },
            
            // Layer 6
            { id: 'https-encryption', name: 'HTTPS encryption', icon: 'üîí', layer: 'Layer 6' },

            // Layer 7
            { id: 'chrome-request', name: 'Chrome requesting a webpage', icon: 'üñ•Ô∏è', layer: 'Layer 7' },
        ];

        const LAYER_EXPLANATIONS = {
            'Layer 7': 'The layer that provides the interface between the user and the network.',
            'Layer 6': 'This layer translates data, handles compression, and manages encryption/decryption.',
            'Layer 5': 'Manages the communication session (setup, maintenance, and termination) between applications.',
            'Layer 4': 'Provides reliable (TCP) or unreliable (UDP) data transfer services for end-to-end communication.',
            'Layer 3': 'Responsible for routing data packets across networks using logical addresses (like IP).',
            'Layer 2': 'Manages data framing, error checking, and physical addressing (MAC) within a local network segment.',
            'Layer 1': 'Concerned with the transmission and reception of raw data bits over a physical communication medium.',
        };

        const currentPlacement = {}; // Tracks the current zone for each item ID

        // --- Drag and Drop Functions ---

        /**
         * Creates an HTML element for a draggable item.
         * @param {object} item - The item object from the ITEMS array.
         * @returns {HTMLElement} The item element.
         */
        function createItemElement(item) {
            const itemElement = document.createElement('div');
            itemElement.draggable = true;
            itemElement.id = `item-${item.id}`;
            // Added smaller text size for better fit in the small boxes
            itemElement.classList.add('draggable-item', 'bg-white', 'p-2', 'rounded-lg', 'shadow-sm', 'flex', 'items-center', 'space-x-2', 'text-xs', 'font-medium', 'text-gray-700', 'hover:bg-gray-50', 'border', 'border-gray-300');
            itemElement.innerHTML = `
                <span class="text-base">${item.icon}</span>
                <span class="whitespace-nowrap">${item.name}</span>
            `;

            itemElement.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', item.id);
                e.currentTarget.classList.add('opacity-50');
            });

            itemElement.addEventListener('dragend', (e) => {
                e.currentTarget.classList.remove('opacity-50');
            });

            return itemElement;
        }

        /**
         * Initializes the item bin and drag/drop listeners on zones.
         */
        function initializeActivity() {
            const itemBin = document.getElementById('item-bin');
            
            // 1. Populate the item bin
            ITEMS.forEach(item => {
                itemBin.appendChild(createItemElement(item));
                currentPlacement[item.id] = 'item-bin'; // Initial placement
            });

            // 2. Setup drag listeners on layer zones
            // Target all item containers: layer-N-items and the item-bin
            const allDropContainers = Array.from({length: 7}, (_, i) => document.getElementById(`layer${i+1}-items`));
            allDropContainers.push(itemBin);
            
            allDropContainers.forEach(dropContainer => {
                
                // Determine the outer zone ID for styling and tracking
                // If it's a layer-items div, find the parent layer-zone. If it's item-bin, use item-bin.
                const outerZone = dropContainer.closest('.layer-zone') || dropContainer;
                const outerZoneId = outerZone.id;
                
                dropContainer.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    // Apply visual feedback to the whole card/bin
                    outerZone.classList.add('drag-over');
                });

                dropContainer.addEventListener('dragleave', (e) => {
                    // Check if the related target is outside the outer zone
                    if (!outerZone.contains(e.relatedTarget)) {
                        outerZone.classList.remove('drag-over');
                    }
                });

                dropContainer.addEventListener('drop', (e) => {
                    e.preventDefault();
                    outerZone.classList.remove('drag-over');
                    
                    const itemId = e.dataTransfer.getData('text/plain');
                    const itemElement = document.getElementById(`item-${itemId}`);
                    
                    if (itemElement) {
                        // Append the item to the specific drop container
                        dropContainer.appendChild(itemElement);
                        
                        // Update tracking using the outer zone's ID (e.g., 'layer7-zone')
                        currentPlacement[itemId] = outerZoneId;
                    }
                });
            });

            // Show initial status message
            const statusBox = document.getElementById('status-message');
            statusBox.classList.remove('hidden');
        }

        /**
         * Checks the current placement against the correct layer for all items.
         */
        function checkStack() {
            let correctCount = 0;
            let totalItems = ITEMS.length;
            const statusBox = document.getElementById('status-message');
            const printButton = document.getElementById('print-button');
            let allPlaced = true;

            ITEMS.forEach(item => {
                const itemElement = document.getElementById(`item-${item.id}`);
                const correctZoneId = `layer${item.layer.split(' ')[1]}-zone`; // 'Layer 7' -> 'layer7-zone'
                const currentZoneId = currentPlacement[item.id];

                // Remove previous color classes
                itemElement.classList.remove('border-green-500', 'border-red-500', 'border-4');
                itemElement.classList.add('border-2'); // Restore default border size for all

                if (currentZoneId === 'item-bin') {
                    allPlaced = false;
                }

                if (currentZoneId === correctZoneId) {
                    // Correct placement
                    correctCount++;
                    itemElement.classList.add('border-green-500', 'border-4');
                } else if (currentZoneId !== 'item-bin') {
                    // Incorrect placement (but placed in a stack zone)
                    itemElement.classList.add('border-red-500', 'border-4');
                }
            });

            // Update status message based on results
            statusBox.classList.remove('bg-blue-100', 'border-blue-500', 'bg-green-100', 'border-green-500', 'bg-red-100', 'border-red-500');
            statusBox.classList.remove('text-blue-700', 'text-green-700', 'text-red-700');

            if (!allPlaced) {
                statusBox.classList.add('bg-blue-100', 'border-blue-500', 'text-blue-700');
                statusBox.innerHTML = `<p class="font-bold">Not all items are placed!</p><p>Please drag all ${totalItems} items into a layer before checking.</p>`;
                printButton.classList.add('hidden');
            } else if (correctCount === totalItems) {
                statusBox.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                statusBox.innerHTML = `<p class="font-bold">Success! (${correctCount}/${totalItems})</p><p>The stack is correctly identified. You can now use the 'Print' button below to save your submission.</p>`;
                printButton.classList.remove('hidden');
            } else {
                statusBox.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                statusBox.innerHTML = `<p class="font-bold">Keep trying! (${correctCount}/${totalItems})</p><p>Items with a thick red border are in the wrong layer. Review the definitions and try again.</p>`;
                printButton.classList.add('hidden');
            }
        }
        
        /**
         * Triggers the browser's print dialog, useful for submission proof.
         */
        function printDiagram() {
            window.print();
        }

        // Start the application
        window.onload = initializeActivity;
    </script>
</body>
</html>
